#ifndef CPU_HPP
#define CPU_HPP

#include <cstdint>
#include <unordered_map>
#include "../interrupt_manager.hpp"
#include "../mmu.hpp"
#include "register.hpp"
#include "opcode.hpp"

class Cpu {
public:
    Cpu(InterruptManager* interrupt_manager, Mmu* mmu) :
        interrupt_manager(interrupt_manager), mmu(mmu) {initialise_opcodes();};
    ~Cpu() {};

    void tick();

private:
    Register reg;
    InterruptManager* interrupt_manager;
    Mmu* mmu;

    // Opcode dictionaries
    std::unordered_map<uint8_t, Opcode> opcodes;
    std::unordered_map<uint8_t, Opcode> cb_opcodes;

    void initialise_opcodes();

    // Variables for the opcodes to manipulate
    uint8_t z8;
    uint16_t z16;
    bool early_exit;
    bool interrupt_enable_scheduled;

    // Basis of cpu functionality
    void add(uint8_t value);
    void add_with_carry(uint8_t value);
    void subtract(uint8_t value);
    void subtract_with_carry(uint8_t value);
    void and_(uint8_t value);
    void or_(uint8_t value);
    void xor_(uint8_t value);
    void compare(uint8_t value);
    uint8_t increment(uint8_t value);
    uint8_t decrement(uint8_t value);

    void add_hl(uint16_t value);
    uint16_t add_signed8(uint16_t value16, int8_t value8);

    uint8_t swap(uint8_t value);
    void decimal_adjust_accumulator();
    void complement_accumulator();
    void complement_carry_flag();
    void set_carry_flag();

    uint8_t rotate_left_circular(uint8_t value);
    uint8_t rotate_left(uint8_t value);
    uint8_t rotate_right_circular(uint8_t value);
    uint8_t rotate_right(uint8_t value);
    uint8_t shift_left_arithmetic(uint8_t value);
    uint8_t shift_right_arithmetic(uint8_t value);
    uint8_t shift_right_logical(uint8_t value);

    void bit(uint8_t value, int position);
    uint8_t set(uint8_t value, int position);
    uint8_t reset(uint8_t value, int position);

    // Opcode methods
    Opcode opcode_0x00();
    Opcode opcode_0x01();
    Opcode opcode_0x02();
    Opcode opcode_0x03();
    Opcode opcode_0x04();
    Opcode opcode_0x05();
    Opcode opcode_0x06();
    Opcode opcode_0x07();
    Opcode opcode_0x08();
    Opcode opcode_0x09();
    Opcode opcode_0x0a();
    Opcode opcode_0x0b();
    Opcode opcode_0x0c();
    Opcode opcode_0x0d();
    Opcode opcode_0x0e();
    Opcode opcode_0x0f();
    Opcode opcode_0x10();
    Opcode opcode_0x11();
    Opcode opcode_0x12();
    Opcode opcode_0x13();
    Opcode opcode_0x14();
    Opcode opcode_0x15();
    Opcode opcode_0x16();
    Opcode opcode_0x17();
    Opcode opcode_0x18();
    Opcode opcode_0x19();
    Opcode opcode_0x1a();
    Opcode opcode_0x1b();
    Opcode opcode_0x1c();
    Opcode opcode_0x1d();
    Opcode opcode_0x1e();
    Opcode opcode_0x1f();
    Opcode opcode_0x20();
    Opcode opcode_0x21();
    Opcode opcode_0x22();
    Opcode opcode_0x23();
    Opcode opcode_0x24();
    Opcode opcode_0x25();
    Opcode opcode_0x26();
    Opcode opcode_0x27();
    Opcode opcode_0x28();
    Opcode opcode_0x29();
    Opcode opcode_0x2a();
    Opcode opcode_0x2b();
    Opcode opcode_0x2c();
    Opcode opcode_0x2d();
    Opcode opcode_0x2e();
    Opcode opcode_0x2f();
    Opcode opcode_0x30();
    Opcode opcode_0x31();
    Opcode opcode_0x32();
    Opcode opcode_0x33();
    Opcode opcode_0x34();
    Opcode opcode_0x35();
    Opcode opcode_0x36();
    Opcode opcode_0x37();
    Opcode opcode_0x38();
    Opcode opcode_0x39();
    Opcode opcode_0x3a();
    Opcode opcode_0x3b();
    Opcode opcode_0x3c();
    Opcode opcode_0x3d();
    Opcode opcode_0x3e();
    Opcode opcode_0x3f();
    Opcode opcode_0x40();
    Opcode opcode_0x41();
    Opcode opcode_0x42();
    Opcode opcode_0x43();
    Opcode opcode_0x44();
    Opcode opcode_0x45();
    Opcode opcode_0x46();
    Opcode opcode_0x47();
    Opcode opcode_0x48();
    Opcode opcode_0x49();
    Opcode opcode_0x4a();
    Opcode opcode_0x4b();
    Opcode opcode_0x4c();
    Opcode opcode_0x4d();
    Opcode opcode_0x4e();
    Opcode opcode_0x4f();
    Opcode opcode_0x50();
    Opcode opcode_0x51();
    Opcode opcode_0x52();
    Opcode opcode_0x53();
    Opcode opcode_0x54();
    Opcode opcode_0x55();
    Opcode opcode_0x56();
    Opcode opcode_0x57();
    Opcode opcode_0x58();
    Opcode opcode_0x59();
    Opcode opcode_0x5a();
    Opcode opcode_0x5b();
    Opcode opcode_0x5c();
    Opcode opcode_0x5d();
    Opcode opcode_0x5e();
    Opcode opcode_0x5f();
    Opcode opcode_0x60();
    Opcode opcode_0x61();
    Opcode opcode_0x62();
    Opcode opcode_0x63();
    Opcode opcode_0x64();
    Opcode opcode_0x65();
    Opcode opcode_0x66();
    Opcode opcode_0x67();
    Opcode opcode_0x68();
    Opcode opcode_0x69();
    Opcode opcode_0x6a();
    Opcode opcode_0x6b();
    Opcode opcode_0x6c();
    Opcode opcode_0x6d();
    Opcode opcode_0x6e();
    Opcode opcode_0x6f();
    Opcode opcode_0x70();
    Opcode opcode_0x71();
    Opcode opcode_0x72();
    Opcode opcode_0x73();
    Opcode opcode_0x74();
    Opcode opcode_0x75();
    Opcode opcode_0x76();
    Opcode opcode_0x77();
    Opcode opcode_0x78();
    Opcode opcode_0x79();
    Opcode opcode_0x7a();
    Opcode opcode_0x7b();
    Opcode opcode_0x7c();
    Opcode opcode_0x7d();
    Opcode opcode_0x7e();
    Opcode opcode_0x7f();
    Opcode opcode_0x80();
    Opcode opcode_0x81();
    Opcode opcode_0x82();
    Opcode opcode_0x83();
    Opcode opcode_0x84();
    Opcode opcode_0x85();
    Opcode opcode_0x86();
    Opcode opcode_0x87();
    Opcode opcode_0x88();
    Opcode opcode_0x89();
    Opcode opcode_0x8a();
    Opcode opcode_0x8b();
    Opcode opcode_0x8c();
    Opcode opcode_0x8d();
    Opcode opcode_0x8e();
    Opcode opcode_0x8f();
    Opcode opcode_0x90();
    Opcode opcode_0x91();
    Opcode opcode_0x92();
    Opcode opcode_0x93();
    Opcode opcode_0x94();
    Opcode opcode_0x95();
    Opcode opcode_0x96();
    Opcode opcode_0x97();
    Opcode opcode_0x98();
    Opcode opcode_0x99();
    Opcode opcode_0x9a();
    Opcode opcode_0x9b();
    Opcode opcode_0x9c();
    Opcode opcode_0x9d();
    Opcode opcode_0x9e();
    Opcode opcode_0x9f();
    Opcode opcode_0xa0();
    Opcode opcode_0xa1();
    Opcode opcode_0xa2();
    Opcode opcode_0xa3();
    Opcode opcode_0xa4();
    Opcode opcode_0xa5();
    Opcode opcode_0xa6();
    Opcode opcode_0xa7();
    Opcode opcode_0xa8();
    Opcode opcode_0xa9();
    Opcode opcode_0xaa();
    Opcode opcode_0xab();
    Opcode opcode_0xac();
    Opcode opcode_0xad();
    Opcode opcode_0xae();
    Opcode opcode_0xaf();
    Opcode opcode_0xb0();
    Opcode opcode_0xb1();
    Opcode opcode_0xb2();
    Opcode opcode_0xb3();
    Opcode opcode_0xb4();
    Opcode opcode_0xb5();
    Opcode opcode_0xb6();
    Opcode opcode_0xb7();
    Opcode opcode_0xb8();
    Opcode opcode_0xb9();
    Opcode opcode_0xba();
    Opcode opcode_0xbb();
    Opcode opcode_0xbc();
    Opcode opcode_0xbd();
    Opcode opcode_0xbe();
    Opcode opcode_0xbf();
    Opcode opcode_0xc0();
    Opcode opcode_0xc1();
    Opcode opcode_0xc2();
    Opcode opcode_0xc3();
    Opcode opcode_0xc4();
    Opcode opcode_0xc5();
    Opcode opcode_0xc6();
    Opcode opcode_0xc7();
    Opcode opcode_0xc8();
    Opcode opcode_0xc9();
    Opcode opcode_0xca();
    Opcode opcode_0xcb();
    Opcode opcode_0xcc();
    Opcode opcode_0xcd();
    Opcode opcode_0xce();
    Opcode opcode_0xcf();
    Opcode opcode_0xd0();
    Opcode opcode_0xd1();
    Opcode opcode_0xd2();
    Opcode opcode_0xd4();
    Opcode opcode_0xd5();
    Opcode opcode_0xd6();
    Opcode opcode_0xd7();
    Opcode opcode_0xd8();
    Opcode opcode_0xd9();
    Opcode opcode_0xda();
    Opcode opcode_0xdc();
    Opcode opcode_0xde();
    Opcode opcode_0xdf();
    Opcode opcode_0xe0();
    Opcode opcode_0xe1();
    Opcode opcode_0xe2();
    Opcode opcode_0xe5();
    Opcode opcode_0xe6();
    Opcode opcode_0xe7();
    Opcode opcode_0xe8();
    Opcode opcode_0xe9();
    Opcode opcode_0xea();
    Opcode opcode_0xee();
    Opcode opcode_0xef();
    Opcode opcode_0xf0();
    Opcode opcode_0xf1();
    Opcode opcode_0xf2();
    Opcode opcode_0xf3();
    Opcode opcode_0xf5();
    Opcode opcode_0xf6();
    Opcode opcode_0xf7();
    Opcode opcode_0xf8();
    Opcode opcode_0xf9();
    Opcode opcode_0xfa();
    Opcode opcode_0xfb();
    Opcode opcode_0xfe();
    Opcode opcode_0xff();

    // CB opcode methods
    Opcode opcode_cb_0x00();
    Opcode opcode_cb_0x01();
    Opcode opcode_cb_0x02();
    Opcode opcode_cb_0x03();
    Opcode opcode_cb_0x04();
    Opcode opcode_cb_0x05();
    Opcode opcode_cb_0x06();
    Opcode opcode_cb_0x07();
    Opcode opcode_cb_0x08();
    Opcode opcode_cb_0x09();
    Opcode opcode_cb_0x0a();
    Opcode opcode_cb_0x0b();
    Opcode opcode_cb_0x0c();
    Opcode opcode_cb_0x0d();
    Opcode opcode_cb_0x0e();
    Opcode opcode_cb_0x0f();
    Opcode opcode_cb_0x10();
    Opcode opcode_cb_0x11();
    Opcode opcode_cb_0x12();
    Opcode opcode_cb_0x13();
    Opcode opcode_cb_0x14();
    Opcode opcode_cb_0x15();
    Opcode opcode_cb_0x16();
    Opcode opcode_cb_0x17();
    Opcode opcode_cb_0x18();
    Opcode opcode_cb_0x19();
    Opcode opcode_cb_0x1a();
    Opcode opcode_cb_0x1b();
    Opcode opcode_cb_0x1c();
    Opcode opcode_cb_0x1d();
    Opcode opcode_cb_0x1e();
    Opcode opcode_cb_0x1f();
    Opcode opcode_cb_0x20();
    Opcode opcode_cb_0x21();
    Opcode opcode_cb_0x22();
    Opcode opcode_cb_0x23();
    Opcode opcode_cb_0x24();
    Opcode opcode_cb_0x25();
    Opcode opcode_cb_0x26();
    Opcode opcode_cb_0x27();
    Opcode opcode_cb_0x28();
    Opcode opcode_cb_0x29();
    Opcode opcode_cb_0x2a();
    Opcode opcode_cb_0x2b();
    Opcode opcode_cb_0x2c();
    Opcode opcode_cb_0x2d();
    Opcode opcode_cb_0x2e();
    Opcode opcode_cb_0x2f();
    Opcode opcode_cb_0x30();
    Opcode opcode_cb_0x31();
    Opcode opcode_cb_0x32();
    Opcode opcode_cb_0x33();
    Opcode opcode_cb_0x34();
    Opcode opcode_cb_0x35();
    Opcode opcode_cb_0x36();
    Opcode opcode_cb_0x37();
    Opcode opcode_cb_0x38();
    Opcode opcode_cb_0x39();
    Opcode opcode_cb_0x3a();
    Opcode opcode_cb_0x3b();
    Opcode opcode_cb_0x3c();
    Opcode opcode_cb_0x3d();
    Opcode opcode_cb_0x3e();
    Opcode opcode_cb_0x3f();
    Opcode opcode_cb_0x40();
    Opcode opcode_cb_0x41();
    Opcode opcode_cb_0x42();
    Opcode opcode_cb_0x43();
    Opcode opcode_cb_0x44();
    Opcode opcode_cb_0x45();
    Opcode opcode_cb_0x46();
    Opcode opcode_cb_0x47();
    Opcode opcode_cb_0x48();
    Opcode opcode_cb_0x49();
    Opcode opcode_cb_0x4a();
    Opcode opcode_cb_0x4b();
    Opcode opcode_cb_0x4c();
    Opcode opcode_cb_0x4d();
    Opcode opcode_cb_0x4e();
    Opcode opcode_cb_0x4f();
    Opcode opcode_cb_0x50();
    Opcode opcode_cb_0x51();
    Opcode opcode_cb_0x52();
    Opcode opcode_cb_0x53();
    Opcode opcode_cb_0x54();
    Opcode opcode_cb_0x55();
    Opcode opcode_cb_0x56();
    Opcode opcode_cb_0x57();
    Opcode opcode_cb_0x58();
    Opcode opcode_cb_0x59();
    Opcode opcode_cb_0x5a();
    Opcode opcode_cb_0x5b();
    Opcode opcode_cb_0x5c();
    Opcode opcode_cb_0x5d();
    Opcode opcode_cb_0x5e();
    Opcode opcode_cb_0x5f();
    Opcode opcode_cb_0x60();
    Opcode opcode_cb_0x61();
    Opcode opcode_cb_0x62();
    Opcode opcode_cb_0x63();
    Opcode opcode_cb_0x64();
    Opcode opcode_cb_0x65();
    Opcode opcode_cb_0x66();
    Opcode opcode_cb_0x67();
    Opcode opcode_cb_0x68();
    Opcode opcode_cb_0x69();
    Opcode opcode_cb_0x6a();
    Opcode opcode_cb_0x6b();
    Opcode opcode_cb_0x6c();
    Opcode opcode_cb_0x6d();
    Opcode opcode_cb_0x6e();
    Opcode opcode_cb_0x6f();
    Opcode opcode_cb_0x70();
    Opcode opcode_cb_0x71();
    Opcode opcode_cb_0x72();
    Opcode opcode_cb_0x73();
    Opcode opcode_cb_0x74();
    Opcode opcode_cb_0x75();
    Opcode opcode_cb_0x76();
    Opcode opcode_cb_0x77();
    Opcode opcode_cb_0x78();
    Opcode opcode_cb_0x79();
    Opcode opcode_cb_0x7a();
    Opcode opcode_cb_0x7b();
    Opcode opcode_cb_0x7c();
    Opcode opcode_cb_0x7d();
    Opcode opcode_cb_0x7e();
    Opcode opcode_cb_0x7f();
    Opcode opcode_cb_0x80();
    Opcode opcode_cb_0x81();
    Opcode opcode_cb_0x82();
    Opcode opcode_cb_0x83();
    Opcode opcode_cb_0x84();
    Opcode opcode_cb_0x85();
    Opcode opcode_cb_0x86();
    Opcode opcode_cb_0x87();
    Opcode opcode_cb_0x88();
    Opcode opcode_cb_0x89();
    Opcode opcode_cb_0x8a();
    Opcode opcode_cb_0x8b();
    Opcode opcode_cb_0x8c();
    Opcode opcode_cb_0x8d();
    Opcode opcode_cb_0x8e();
    Opcode opcode_cb_0x8f();
    Opcode opcode_cb_0x90();
    Opcode opcode_cb_0x91();
    Opcode opcode_cb_0x92();
    Opcode opcode_cb_0x93();
    Opcode opcode_cb_0x94();
    Opcode opcode_cb_0x95();
    Opcode opcode_cb_0x96();
    Opcode opcode_cb_0x97();
    Opcode opcode_cb_0x98();
    Opcode opcode_cb_0x99();
    Opcode opcode_cb_0x9a();
    Opcode opcode_cb_0x9b();
    Opcode opcode_cb_0x9c();
    Opcode opcode_cb_0x9d();
    Opcode opcode_cb_0x9e();
    Opcode opcode_cb_0x9f();
    Opcode opcode_cb_0xa0();
    Opcode opcode_cb_0xa1();
    Opcode opcode_cb_0xa2();
    Opcode opcode_cb_0xa3();
    Opcode opcode_cb_0xa4();
    Opcode opcode_cb_0xa5();
    Opcode opcode_cb_0xa6();
    Opcode opcode_cb_0xa7();
    Opcode opcode_cb_0xa8();
    Opcode opcode_cb_0xa9();
    Opcode opcode_cb_0xaa();
    Opcode opcode_cb_0xab();
    Opcode opcode_cb_0xac();
    Opcode opcode_cb_0xad();
    Opcode opcode_cb_0xae();
    Opcode opcode_cb_0xaf();
    Opcode opcode_cb_0xb0();
    Opcode opcode_cb_0xb1();
    Opcode opcode_cb_0xb2();
    Opcode opcode_cb_0xb3();
    Opcode opcode_cb_0xb4();
    Opcode opcode_cb_0xb5();
    Opcode opcode_cb_0xb6();
    Opcode opcode_cb_0xb7();
    Opcode opcode_cb_0xb8();
    Opcode opcode_cb_0xb9();
    Opcode opcode_cb_0xba();
    Opcode opcode_cb_0xbb();
    Opcode opcode_cb_0xbc();
    Opcode opcode_cb_0xbd();
    Opcode opcode_cb_0xbe();
    Opcode opcode_cb_0xbf();
    Opcode opcode_cb_0xc0();
    Opcode opcode_cb_0xc1();
    Opcode opcode_cb_0xc2();
    Opcode opcode_cb_0xc3();
    Opcode opcode_cb_0xc4();
    Opcode opcode_cb_0xc5();
    Opcode opcode_cb_0xc6();
    Opcode opcode_cb_0xc7();
    Opcode opcode_cb_0xc8();
    Opcode opcode_cb_0xc9();
    Opcode opcode_cb_0xca();
    Opcode opcode_cb_0xcb();
    Opcode opcode_cb_0xcc();
    Opcode opcode_cb_0xcd();
    Opcode opcode_cb_0xce();
    Opcode opcode_cb_0xcf();
    Opcode opcode_cb_0xd0();
    Opcode opcode_cb_0xd1();
    Opcode opcode_cb_0xd2();
    Opcode opcode_cb_0xd3();
    Opcode opcode_cb_0xd4();
    Opcode opcode_cb_0xd5();
    Opcode opcode_cb_0xd6();
    Opcode opcode_cb_0xd7();
    Opcode opcode_cb_0xd8();
    Opcode opcode_cb_0xd9();
    Opcode opcode_cb_0xda();
    Opcode opcode_cb_0xdb();
    Opcode opcode_cb_0xdc();
    Opcode opcode_cb_0xdd();
    Opcode opcode_cb_0xde();
    Opcode opcode_cb_0xdf();
    Opcode opcode_cb_0xe0();
    Opcode opcode_cb_0xe1();
    Opcode opcode_cb_0xe2();
    Opcode opcode_cb_0xe3();
    Opcode opcode_cb_0xe4();
    Opcode opcode_cb_0xe5();
    Opcode opcode_cb_0xe6();
    Opcode opcode_cb_0xe7();
    Opcode opcode_cb_0xe8();
    Opcode opcode_cb_0xe9();
    Opcode opcode_cb_0xea();
    Opcode opcode_cb_0xeb();
    Opcode opcode_cb_0xec();
    Opcode opcode_cb_0xed();
    Opcode opcode_cb_0xee();
    Opcode opcode_cb_0xef();
    Opcode opcode_cb_0xf0();
    Opcode opcode_cb_0xf1();
    Opcode opcode_cb_0xf2();
    Opcode opcode_cb_0xf3();
    Opcode opcode_cb_0xf4();
    Opcode opcode_cb_0xf5();
    Opcode opcode_cb_0xf6();
    Opcode opcode_cb_0xf7();
    Opcode opcode_cb_0xf8();
    Opcode opcode_cb_0xf9();
    Opcode opcode_cb_0xfa();
    Opcode opcode_cb_0xfb();
    Opcode opcode_cb_0xfc();
    Opcode opcode_cb_0xfd();
    Opcode opcode_cb_0xfe();
    Opcode opcode_cb_0xff();

};

#endif